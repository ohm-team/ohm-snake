!function(){var e={608:function(e){var t,i,n,o,r;t=console.log,i=console.warn,n=console.error,o=console.debug,r={unbind:function(){console.log=t,console.warn=i,console.error=n,console.debug=o},bind:function(e,r){if("function"!=typeof e)return console.error("You must pass a valid callback function."),!1;r=Boolean(r);const a="info",s="warn",c="error",d="debug";console.log=console.info=function(){t&&(r||t.call(console,...arguments),e(a,arguments))},console.warn=function(){i&&(r||i.call(console,...arguments),e(s,arguments))},console.error=function(){n&&(r||n.call(console,...arguments),e(c,arguments))},console.debug=function(){o&&(r||o.call(console,...arguments),e(d,arguments))}}},void 0!==e.exports?e.exports=r:window&&"object"==typeof window?window.ConsoleSubscriber=r:console.error("Failed to export module.")},90:function(e,t,i){"use strict";i.r(t)},553:function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.enableMobileConsole=void 0;const o=n(i(608));t.enableMobileConsole=()=>{const e=[];o.default.bind(((t,i)=>{5===e.length&&e.shift(),e.push({category:t,message:i[0]}),document.getElementById("console").innerHTML=e.map((e=>`<p>${e.message}</p>`)).join("")}))}},115:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},143:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.startSnakeGame=void 0;const a=r(i(428)),s=i(131);var c,d,l,u,h,f,m=.1,g=(new a.Vector3,new a.Matrix4,new a.Vector3),v={38:"backward",40:"forward",39:"right",37:"left",87:"up",83:"down",32:"pause"};function p(){var e,t=(e=Math.floor(5*Math.random()/2*2))-e%m;return t>5?5-t-1:t-1}function b(e,t,i){const n=new a.BoxBufferGeometry(m,m,m),o=new a.Mesh(n,new a.MeshBasicMaterial({opacity:0,transparent:!0}));o.name="Food";var r=new a.Group;return r.rotateY(Math.PI/2),(new a.FBXLoader).load("./models/fruit.fbx",(function(e){e.name="FoodFBX",e.scale.set(.1,.1,.1),e.children[2].material=new a.MeshLambertMaterial({color:6032141}),r.add(e)})),o.add(r),o.position.set(e,t,i),d.add(o),h.setCurrentTagPosition({x:e,y:t,z:i}),o}function w(){requestAnimationFrame(w),h.render(),c.lookAt(h.getHead().position),g.setFromMatrixPosition(h.cameraGoal.matrixWorld),c.position.lerp(g,.05),l.render(d,c)}t.startSnakeGame=e=>{const t=function(e){var t=document.getElementById("snakeCanvas");(c=new a.PerspectiveCamera(70,window.innerWidth/window.innerHeight,.01,10)).position.set(0,2,-2),(e=>{let t;t=new a.HemisphereLight(11184810,4473924,.7),t.position.set(0,-1,0),e.add(t),t=new a.DirectionalLight(15915390,2),e.add(t),t=new a.DirectionalLight(16109222,.8),t.position.set(0,0,1),e.add(t),t=new a.DirectionalLight(16109222,.3),t.position.set(0,0,-1),e.add(t),t=new a.DirectionalLight(11851483,.6),t.position.set(-1,0,0),e.add(t),t=new a.DirectionalLight(11851483,.6),t.position.set(1,0,0),e.add(t)})(d=new a.Scene),c.lookAt(d.position),u=new a.Object3D,(h=new s.Snake(d,m,65280,u)).render(),h.onTagCollision=function(){d.remove(f),f=b(p(),m,p())},h.onSelfCollision=function(){e(),h.reset()},u.position.set(0,.4,-.5),f=b(p(),.05,p());var i=new a.GridHelper(5,50);d.add(i),d.add(new a.AxesHelper),(l=new a.WebGLRenderer({canvas:t,antialias:!0})).setSize(window.innerWidth,window.innerHeight);var n={right:{enabled:!0,action:function(){h.turn("right"),n.pause.enabled=!0}},left:{enabled:!0,action:function(){h.turn("left"),n.pause.enabled=!0}},pause:{enabled:!1,action:function(){h.clear(),n.pause.enabled=!1}}};return document.addEventListener("keyup",(function(e){var t=n[v[e.keyCode]];t&&t.enabled&&t.action()}),!1),n.left.action(),{turnLeft:n.left.action,turnRight:n.right.action}}(e);return w(),t}},341:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t},a=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{c(n.next(e))}catch(e){r(e)}}function s(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=i(553);i(115),i(143);const c=i(970),d=i(263),l=i(409),u=i(393),h=i(646);i(90);const f=r(i(891)),m=$("#startButton"),g=$("#preloader"),v=$("#start"),p=$("#game"),b=$("#nameInput"),w=e=>a(void 0,void 0,void 0,(function*(){console.log("start game"),p.show(),v.hide(),h.startGameController(e),f.playMusic(),f.renderDebugButtons()}));window.onload=()=>a(void 0,void 0,void 0,(function*(){s.enableMobileConsole(),yield a(void 0,void 0,void 0,(function*(){g.show(),p.hide(),v.hide(),yield a(void 0,void 0,void 0,(function*(){return Promise.all([d.initImageCapture(),u.initVoiceService(),c.initHeadControl({onCameraPersmissionFailed:()=>alert("This game is head-controlled. You need to enable camera to play the game.")}),l.initVisibilityService(),f.default()]).then((()=>{g.hide(),v.show()})).catch((e=>{console.log(e)}))})),b.on("input",(()=>{b.val()?m.prop("disabled",!1):m.prop("disabled",!0)})),m.click((()=>a(void 0,void 0,void 0,(function*(){yield w(b.val())}))))}))}))},660:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EVENT_MOVEMENT=void 0,t.EVENT_MOVEMENT="movement";const i={mouseOpeningTreshold:.6,mouseClosingTreshold:.5,headMovementStartedTreshold:.15,headMovementStoppedTreshold:.08};class n extends EventTarget{constructor(e,n){super(),this.movementLocks={vertical:!1,horizontal:!1,mouseOpened:!1},this.state={isLoaded:!1,isDetected:!1,isEnabled:!1},this.gl=null,this.cv=null,this.videoTexture=null,this.videoTransformMat2=null,this.glHeadSearchDrawShaderProgram=null,this.headSearchUniformXys=null,this.headSearchUniformVideoTransformMat2=null,this.handleMouseOpening=e=>{if(e.ry<-1*this.settings.headMovementStartedTreshold||e.ry>this.settings.headMovementStartedTreshold)return;let i=5*(e.expressions[0]-.2);return i=Math.min(Math.max(i,0),1),i>this.settings.mouseOpeningTreshold&&!this.movementLocks.mouseOpened?(this.movementLocks.mouseOpened=!0,void this.dispatchEvent(new CustomEvent(t.EVENT_MOVEMENT,{detail:"mouth opened"}))):i<this.settings.mouseClosingTreshold&&this.movementLocks.mouseOpened?(this.movementLocks.mouseOpened=!1,void this.dispatchEvent(new CustomEvent(t.EVENT_MOVEMENT,{detail:"mouth closed"}))):void 0},this.handleMove=e=>{0!==e.rx&&this.handleAxisMovement({axis:"vertical",axisPosition:e.rx,maxValue:"down",minValue:"up"}),0!==e.ry&&this.handleAxisMovement({axis:"horizontal",axisPosition:e.ry,maxValue:"left",minValue:"right"})},this.handleAxisMovement=({axis:e,axisPosition:i,maxValue:n,minValue:o})=>i<-1*this.settings.headMovementStartedTreshold&&!this.movementLocks[e]?(this.movementLocks[e]=!0,void this.dispatchEvent(new CustomEvent(t.EVENT_MOVEMENT,{detail:o}))):i>this.settings.headMovementStartedTreshold&&!this.movementLocks[e]?(this.movementLocks[e]=!0,void this.dispatchEvent(new CustomEvent(t.EVENT_MOVEMENT,{detail:n}))):void(i>-1*this.settings.headMovementStoppedTreshold&&i<this.settings.headMovementStoppedTreshold&&(this.movementLocks[e]=!1)),this.settings=Object.assign(Object.assign({},i),n),window.JEEFACEFILTERAPI.init({canvasId:e,NNCPath:"./vendor/",animateDelay:20,callbackReady:(e,t)=>{if(e)return(e="WEBCAM_UNAVAILABLE")?void(n.onCameraPersmissionFailed&&n.onCameraPersmissionFailed()):void n.onError(new Error(e));this.gl=t.GL,this.videoTexture=t.videoTexture,this.videoTransformMat2=t.videoTransformMat2,this.cv=t.canvasElement,this.videoElement=t.videoElement,this.initHeadSearchDraw(),this.state.isLoaded=!0,n.onReady&&n.onReady()},callbackTrack:e=>{this.state.isEnabled&&(this.drawHeadSearch(e),this.handleMove(e),this.handleMouseOpening(e))}})}getVideoElement(){return this.videoElement}toggle(e){return this.state.isEnabled===e||(this.state.isEnabled=e),!0}compileShader(e,t,i){const n=this.gl.createShader(t);return this.gl.shaderSource(n,e),this.gl.compileShader(n),this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS)?n:(alert("ERROR IN "+i+" SHADER: "+this.gl.getShaderInfoLog(n)),null)}initHeadSearchDraw(){const e=this.compileShader("\n      attribute vec2 aat_position;\n      varying vec2 vUV;\n      \n      void main(void) {\n        gl_Position = vec4(aat_position, 0., 1.);\n        vUV = 0.5 + 0.5 * aat_position;\n        vUV.x = 1.-vUV.x; // mirror diplay\n      }",this.gl.VERTEX_SHADER,"VERTEX"),t=this.compileShader("\n      precision lowp float;\n      varying vec2 vUV;\n      \n      uniform sampler2D samplerVideo;\n      uniform mat2 videoTransformMat2;\n      uniform vec3 uxys;\n      \n      void main(void) {\n        vec2 uvVideoCentered = 2.0 * videoTransformMat2 * (vUV - 0.5);\n        vec2 uvVideo = uvVideoCentered + 0.5;\n        vec3 colorVideo = texture2D(samplerVideo, uvVideo).rgb;\n        vec2 pos = vUV*2.-vec2(1.,1.);\n        vec2 isInside = step(uxys.xy-uxys.z*vec2(1.,1.), pos);\n        isInside *= step(pos, uxys.xy+uxys.z*vec2(1.,1.));\n        vec2 blendCenterFactor = abs(pos-uxys.xy) / uxys.z;\n        float alpha = isInside.x * isInside.y * pow(max(blendCenterFactor.x, blendCenterFactor.y), 3.);\n        vec3 color = mix(colorVideo, vec3(0.,0.6,1.), alpha);\n        gl_FragColor = vec4(color,1.);\n      }",this.gl.FRAGMENT_SHADER,"FRAGMENT");this.glHeadSearchDrawShaderProgram=this.gl.createProgram(),this.gl.attachShader(this.glHeadSearchDrawShaderProgram,e),this.gl.attachShader(this.glHeadSearchDrawShaderProgram,t),this.gl.linkProgram(this.glHeadSearchDrawShaderProgram);const i=this.gl.getUniformLocation(this.glHeadSearchDrawShaderProgram,"samplerVideo");this.headSearchUniformXys=this.gl.getUniformLocation(this.glHeadSearchDrawShaderProgram,"uxys"),this.headSearchUniformVideoTransformMat2=this.gl.getUniformLocation(this.glHeadSearchDrawShaderProgram,"videoTransformMat2"),this.gl.useProgram(this.glHeadSearchDrawShaderProgram),this.gl.uniform1i(i,0)}drawHeadSearch(e){this.gl.viewport(0,0,this.cv.width,this.cv.height),this.gl.useProgram(this.glHeadSearchDrawShaderProgram),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.videoTexture),this.gl.uniform3f(this.headSearchUniformXys,e.x,e.y,e.s),this.gl.uniformMatrix2fv(this.headSearchUniformVideoTransformMat2,!1,this.videoTransformMat2),this.gl.drawElements(this.gl.TRIANGLES,3,this.gl.UNSIGNED_SHORT,0)}}t.default=n},970:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.disableControls=t.enableControls=t.getVideoElement=t.initHeadControl=void 0;const a=r(i(660));let s,c;t.initHeadControl=({onCameraPersmissionFailed:e})=>new Promise(((t,i)=>{s=new a.default("head-preview",{onReady:t,onCameraPersmissionFailed:e,onError:i})})),t.getVideoElement=()=>{if(!s)throw new Error("Call initHeadControl first");return s.getVideoElement()},t.enableControls=({onMovement:e})=>{s.toggle(!0),c=t=>e(t.detail),s.addEventListener(a.EVENT_MOVEMENT,c)},t.disableControls=()=>{s.toggle(!1),c&&s.removeEventListener(a.EVENT_MOVEMENT,c)}},860:function(){var e=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{c(n.next(e))}catch(e){r(e)}}function s(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))};"createImageBitmap"in window||(window.createImageBitmap=function(t){return e(this,void 0,void 0,(function*(){return new Promise(((e,i)=>{let n=document.createElement("img");n.addEventListener("load",(function(){e(this)})),n.src=URL.createObjectURL(t)}))}))})},330:function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{c(n.next(e))}catch(e){r(e)}}function s(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.CapturePolyfill=void 0;const o=i(970);t.CapturePolyfill={takePhoto:()=>n(void 0,void 0,void 0,(function*(){return new Promise((e=>{const t=o.getVideoElement(),i=document.createElement("canvas"),n=i.getContext("2d");i.width=t.videoWidth,i.height=t.videoHeight,n.drawImage(t,0,0),i.toBlob(e)}))}))}},140:function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.gif=void 0;const o=n(i(967));t.gif=(e,t)=>{o.default.createGIF({images:e,gifWidth:300,gifHeight:300},(function(e){if(!e.error){const i=e.image,n=document.createElement("img");n.src=i,$(t).append(n)}}))}},263:function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{c(n.next(e))}catch(e){r(e)}}function s(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.initImageCapture=t.takePhoto=t.makeGif=void 0,i(330),i(860);const o=i(330),r=i(140);let a,s=!1;const c=[];t.makeGif=()=>{r.gif(c,"#gifContainer")},t.takePhoto=()=>n(void 0,void 0,void 0,(function*(){a?yield a.takePhoto().then((e=>createImageBitmap(e))).then((e=>{const t=document.querySelector("#takePhotoCanvas");t.style.display="block",function(e,t){e.width=getComputedStyle(e).width.split("px")[0],e.height=getComputedStyle(e).height.split("px")[0];let i=Math.min(e.width/t.width,e.height/t.height),n=(e.width-t.width*i)/2,o=(e.height-t.height*i)/2;e.getContext("2d").clearRect(0,0,e.width,e.height),e.getContext("2d").drawImage(t,0,0,t.width,t.height,n,o,t.width*i,t.height*i)}(t,e),c.push(t.toDataURL("image/jpeg"))})).catch((e=>{console.log(e)})):console.log("no image capture")})),t.initImageCapture=()=>n(void 0,void 0,void 0,(function*(){return s?Promise.resolve():(s=!0,navigator.mediaDevices.getUserMedia({video:!0}).then((e=>{try{const t=e.getVideoTracks()[0];a=new ImageCapture(t)}catch(e){a=o.CapturePolyfill}})).catch((()=>{alert("Image capture is not supported on your device :(")})))}))},309:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=new(AudioContext||webkitAudioContext),t=e.createGain();t.gain.value=.1,t.connect(e.destination);var i=e.currentTime,n=function(){var t=e.createScriptProcessor(4096,1,1);t.bits=4,t.normfreq=.1;var i=Math.pow(.5,t.bits),n=0,o=0;return t.onaudioprocess=function(e){for(var r=e.inputBuffer.getChannelData(0),a=e.outputBuffer.getChannelData(0),s=0;s<4096;s++)(n+=t.normfreq)>=1&&(n-=1,o=i*Math.floor(r[s]/i+.5)),a[s]=o},t}(),o=e.createOscillator();o.type="sawtooth",o.start(i);var r=e.createGain();n.connect(r),r.connect(t),o.connect(n),o.frequency.setValueAtTime(220,i),o.frequency.linearRampToValueAtTime(1760,i+4),r.gain.setValueAtTime(1,i),r.gain.setValueAtTime(1,i+4),r.gain.linearRampToValueAtTime(0,i+5)}},189:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=()=>{const e=function(){const e=new(AudioContext||webkitAudioContext),t=e.createOscillator(),i=e.createGain();return t.connect(i),i.connect(e.destination),t.start(0),e.suspend(),t.type="square",t.frequency.value=100,i.gain.value=.1,e}(),t=()=>setTimeout((()=>e.suspend()),750);return t(),()=>{"running"===e.state?e.suspend():"suspended"===e.state&&(e.resume(),t())}}},891:function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{c(n.next(e))}catch(e){r(e)}}function s(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.renderDebugButtons=t.playBoo=t.playGameOver=t.stopMusic=t.playMusic=void 0;const r=o(i(55)),a=o(i(309)),s=o(i(189));let c,d;t.default=()=>n(void 0,void 0,void 0,(function*(){return Promise.all([r.default()]).then((([e])=>{c=e,d=s.default()}))})),t.playMusic=()=>c.play(),t.stopMusic=()=>c.stop(),t.playGameOver=()=>a.default(),t.playBoo=()=>d(),t.renderDebugButtons=()=>{const e=document.createElement("fieldset");e.style.position="absolute",e.style.top="0",e.style.right="0",document.body.appendChild(e);const i=t=>{const i=document.createElement("button");i.textContent=`play:${t}`;let n=!1;i.onclick=()=>{const e=`${n?"stop":"play"}:${t}`,o=new CustomEvent(e);n=!n,i.textContent=e,window.dispatchEvent(o)},e.appendChild(i)};i("music"),i("crush"),i("boo"),window.addEventListener("play:music",t.playMusic),window.addEventListener("stop:music",t.stopMusic),window.addEventListener("play:crush",t.playGameOver),window.addEventListener("play:boo",t.playBoo)}},55:function(e,t){"use strict";var i=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{c(n.next(e))}catch(e){r(e)}}function s(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n="/ohm-snake/audio/monsterslap.mp3";console.log({url:n}),t.default=function(){return i(this,void 0,void 0,(function*(){const e=new(AudioContext||webkitAudioContext),t=yield function(e,t){return i(this,void 0,void 0,(function*(){const t=yield fetch("/ohm-snake/audio/monsterslap.mp3"),i=yield t.arrayBuffer();return yield e.decodeAudioData(i)}))}(e);let n,r=0;return{play:()=>{n=o(e,t),n.start(0,r,n.duration),r=0},stop:()=>{r=e.currentTime-0,n.stop(0)}}}))};const o=(e,t)=>{const i=e.createBufferSource();return i.buffer=t,i.connect(e.destination),i.loop=!0,i}},755:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EVENT_CHANGE=void 0,t.EVENT_CHANGE="change";class i extends EventTarget{constructor(){super(),this.handleVisibilityChange=()=>{const{hidden:e}=this.getVisibilityApiNames();document[e]?this.dispatchEvent(new CustomEvent(t.EVENT_CHANGE,{detail:"invisible"})):this.dispatchEvent(new CustomEvent(t.EVENT_CHANGE,{detail:"visible"}))},this.getVisibilityApiNames=()=>{var e,t;return void 0!==document.hidden?(e="hidden",t="visibilitychange"):void 0!==document.msHidden?(e="msHidden",t="msvisibilitychange"):void 0!==document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),{hidden:e,visibilityChange:t}};const{visibilityChange:e}=this.getVisibilityApiNames();e||console.warn("Visiblity API is not availible. Some of the features will not work."),document.addEventListener(e,this.handleVisibilityChange,!1)}}t.default=i},409:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.unListenForVisibilityChange=t.listenForVisibilityChange=t.initVisibilityService=void 0;const a=r(i(755));let s,c;t.initVisibilityService=()=>(s=new a.default,Promise.resolve()),t.listenForVisibilityChange=({onVisibilityChange:e})=>{c=t=>e(t.detail),s.addEventListener(a.EVENT_CHANGE,c)},t.unListenForVisibilityChange=()=>{c&&s.removeEventListener(a.EVENT_CHANGE,c)}},393:function(e,t){"use strict";var i=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{c(n.next(e))}catch(e){r(e)}}function s(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))};let n;Object.defineProperty(t,"__esModule",{value:!0}),t.saySomething=t.setUpUser=t.PHRASES=t.initVoiceService=void 0,t.initVoiceService=()=>i(void 0,void 0,void 0,(function*(){return new Promise((e=>{setTimeout((()=>{n=window.speechSynthesis.getVoices().find((({lang:e})=>"en-GB"===e)),n?(console.log("voice init"),e(!0)):t.initVoiceService().then(e)}),500)}))})),t.PHRASES={HELLO:"`Hi, %username%. Have a good game",RIGHT:"Good right turn, %username%"};let o="";t.setUpUser=e=>{o=e},t.saySomething=e=>{if(!n)return;const t=new SpeechSynthesisUtterance(e.replace("%username%",o));t.voice=n,t.volume=1,t.pitch=1,t.rate=1,speechSynthesis.cancel(),speechSynthesis.speak(t)}},131:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Snake=void 0;const a=r(i(428)),s=i(253);function c(e,t,i,n){this.snake=[],this.scene=e,this.size=t,this.color=i,this.pathPoints=[[0,0,0]],this.distance=t/4,this.initialSize=4,this.speed=.01,this.liveTime=0,this.cameraGoal=n,this.direction=null,this.axis=null,this.onSelfCollision=function(){},this.onTagCollision=function(){},this.position=null,this.tagPosition=null,this.geometry=new a.BoxGeometry(this.size,this.size,this.size),this.material=new a.MeshNormalMaterial,this.init()}t.Snake=c,c.prototype={init:function(){for(var e=0;e<this.initialSize;e++)this.addCube();this.setDefaultPositions(),this.getHead().add(this.cameraGoal);const{x:t,y:i,z:n}=this.getTail().position;this.pathPoints.push([t,i,n])},setDefaultPositions:function(){var e=this;this.snake.forEach((function(t,i){t.position.z=(e.distance+e.size)*i*-1,t.position.y=e.size/2,t.position.x=0})),this.getHead().rotateY(0)},reset:function(){this.init()},selfCollision:function(){console.log("self collision"),this.onSelfCollision(),this.clear()},tagCollision:function(){this.speed=1.25*this.speed,console.log("speed",this.speed),this.onTagCollision(),this.addCube()},setCurrentTagPosition:function(e){this.tagPosition=e},isHit:function(e,t,i){let n=e.y-i/2,o=e.y+i/2,r=e.x+i/2,a=e.x-i/2,s=e.z-i/2,c=e.z+i/2,d=t.y-i/2,l=t.y+i/2,u=t.x+i/2,h=t.x-i/2,f=t.z-i/2,m=t.z+i/2;return!(o<d||r<h||n>l||a>u||s>m||c<f)},getHead:function(){return this.snake[0]},getTail:function(){return this.snake[this.snake.length-1]},addPointToPath:function(e){this.pathPoints.splice(1,0,e)},updateFirstPoint:function(){this.pathPoints[0]=this.getPositionAsVector()},getPositionAsVector:function(){return this.position?[this.position.x,this.position.y,this.position.z]:[0,0,0]},createCube:function(e){return new a.Mesh(this.geometry,this.material)},addCube:function(){this.snake.push(this.createCube())},render:function(){this.liveTime++;var e=this;this.snake.forEach((function(t,i){if(null!==e.axis&&null!==e.direction)if(0===i)t.position[e.axis]+=e.direction*e.speed,e.position={x:t.position.x,y:t.position.y,z:t.position.z},e.updateFirstPoint(),e.tagPosition&&e.isHit(e.position,e.tagPosition,e.size)&&e.tagCollision();else{const n=i*(e.size+e.distance),[o,r,a]=s.findPointByDistance(e.pathPoints,n);t.position.set(o,r,a),1!==i&&e.isHit(e.position,t.position,e.size)&&e.selfCollision()}e.renderCube(t)}))},turn:function(e){if(this.addPointToPath(this.getPositionAsVector()),this.direction){if("right"==e){if(this.getHead().rotateY(-90*s.DEGTORAD),"z"==this.axis&&1==this.direction)return void this.left();if("z"==this.axis&&-1==this.direction)return void this.right();if("x"==this.axis&&1==this.direction)return void this.forward();if("x"==this.axis&&-1==this.direction)return void this.back()}if("left"==e){if(this.getHead().rotateY(90*s.DEGTORAD),"z"==this.axis&&1==this.direction)return void this.right();if("z"==this.axis&&-1==this.direction)return void this.left();if("x"==this.axis&&1==this.direction)return void this.back();if("x"==this.axis&&-1==this.direction)return void this.forward()}}else this.forward()},back:function(){this.axis="z",this.direction=-1,console.log("back")},forward:function(){this.axis="z",this.direction=1,console.log("fwd")},right:function(){this.axis="x",this.direction=1,console.log("right")},left:function(){this.axis="x",this.direction=-1,console.log("left")},clear:function(){this.axis=null,this.direction=null,this.pathPoints=[[0,0,0]]},renderCube:function(e){this.scene.add(e)}}},253:function(e,t){"use strict";function i([e,t,i],[n,o,r],a){return[e+(n-e)*a,t,i+(r-i)*a]}Object.defineProperty(t,"__esModule",{value:!0}),t.findPointByDistance=t.midpoint=t.dist=t.DEGTORAD=void 0,t.DEGTORAD=.01745327,t.dist=([e,t,i],[n,o,r])=>{var a=e-n,s=i-r;return Math.sqrt(a*a+s*s)},t.midpoint=i,t.findPointByDistance=(e,n)=>{let o=0,r=null;return e.forEach(((a,s)=>{if(r);else{if(e.length<=s+1)return void(r=a);let c=e[s+1],d=t.dist(a,c);if(o+d>=n)return void(r=i(a,c,(n-o)/d));o+=d}})),r}},646:function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{c(n.next(e))}catch(e){r(e)}}function s(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.startGameController=void 0;const o=i(143),r=i(970),a=i(263),s=i(891),c=i(409),d=i(393);t.startGameController=e=>n(void 0,void 0,void 0,(function*(){try{d.setUpUser(e),d.saySomething(d.PHRASES.HELLO);const{turnLeft:t,turnRight:i}=o.startSnakeGame(l),n=e=>{a.takePhoto(),"left"===e&&(t(),s.playBoo()),"right"===e&&(i(),s.playBoo())};r.enableControls({onMovement:n});const u=e=>{"visible"!==e?console.log("pause!"):console.log("unpause!")};c.listenForVisibilityChange({onVisibilityChange:u})}catch(e){console.error(e),alert(e)}}));const l=()=>{$("#game").hide(),$("#gameover").show(),$("#replay").click((()=>{window.location.reload()})),a.makeGif(),s.stopMusic(),s.playGameOver()}},967:function(e,t){var i;!function(n,o,r,a){"use strict";var s,c,d={URL:n.URL||n.webkitURL||n.mozURL||n.msURL,getUserMedia:(c=r.getUserMedia||r.webkitGetUserMedia||r.mozGetUserMedia||r.msGetUserMedia,c?c.bind(r):c),requestAnimFrame:n.requestAnimationFrame||n.webkitRequestAnimationFrame||n.mozRequestAnimationFrame||n.oRequestAnimationFrame||n.msRequestAnimationFrame,requestTimeout:function(e,t){if(e=e||d.noop,t=t||0,!d.requestAnimFrame)return setTimeout(e,t);var i=(new Date).getTime(),n=new Object,o=d.requestAnimFrame;return n.value=o((function r(){(new Date).getTime()-i>=t?e.call():n.value=o(r)})),n},Blob:n.Blob||n.BlobBuilder||n.WebKitBlobBuilder||n.MozBlobBuilder||n.MSBlobBuilder,btoa:(s=n.btoa||function(e){for(var t="",i=0,n=e.length,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r=void 0,a=void 0,s=void 0,c=void 0,d=void 0,l=void 0,u=void 0;i<n;)c=(r=e.charCodeAt(i++))>>2,d=(3&r)<<4|(a=e.charCodeAt(i++))>>4,l=(15&a)<<2|(s=e.charCodeAt(i++))>>6,u=63&s,isNaN(a)?l=u=64:isNaN(s)&&(u=64),t=t+o.charAt(c)+o.charAt(d)+o.charAt(l)+o.charAt(u);return t},s?s.bind(n):d.noop),isObject:function(e){return e&&"[object Object]"===Object.prototype.toString.call(e)},isEmptyObject:function(e){return d.isObject(e)&&!Object.keys(e).length},isArray:function(e){return e&&Array.isArray(e)},isFunction:function(e){return e&&"function"==typeof e},isElement:function(e){return e&&1===e.nodeType},isString:function(e){return"string"==typeof e||"[object String]"===Object.prototype.toString.call(e)},isSupported:{canvas:function(){var e=o.createElement("canvas");return e&&e.getContext&&e.getContext("2d")},webworkers:function(){return n.Worker},blob:function(){return d.Blob},Uint8Array:function(){return n.Uint8Array},Uint32Array:function(){return n.Uint32Array},videoCodecs:function(){var e=o.createElement("video"),t={mp4:!1,h264:!1,ogv:!1,ogg:!1,webm:!1};try{e&&e.canPlayType&&(t.mp4=""!==e.canPlayType('video/mp4; codecs="mp4v.20.8"'),t.h264=""!==(e.canPlayType('video/mp4; codecs="avc1.42E01E"')||e.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')),t.ogv=""!==e.canPlayType('video/ogg; codecs="theora"'),t.ogg=""!==e.canPlayType('video/ogg; codecs="theora"'),t.webm=-1!==e.canPlayType('video/webm; codecs="vp8, vorbis"'))}catch(e){}return t}()},noop:function(){},each:function(e,t){var i=void 0,n=void 0;if(d.isArray(e))for(i=-1,n=e.length;++i<n&&!1!==t(i,e[i]););else if(d.isObject(e))for(i in e)if(e.hasOwnProperty(i)&&!1===t(i,e[i]))break},mergeOptions:function(e,t){if(d.isObject(e)&&d.isObject(t)&&Object.keys){var i={};return d.each(e,(function(t,n){i[t]=e[t]})),d.each(t,(function(n,o){var r=t[n];d.isObject(r)&&e[n]?i[n]=d.mergeOptions(e[n],r):i[n]=r})),i}},setCSSAttr:function(e,t,i){d.isElement(e)&&(d.isString(t)&&d.isString(i)?e.style[t]=i:d.isObject(t)&&d.each(t,(function(t,i){e.style[t]=i})))},removeElement:function(e){d.isElement(e)&&e.parentNode&&e.parentNode.removeChild(e)},createWebWorker:function(e){if(!d.isString(e))return{};try{var t=new d.Blob([e],{type:"text/javascript"}),i=d.URL.createObjectURL(t);return{objectUrl:i,worker:new Worker(i)}}catch(e){return""+e}},getExtension:function(e){return e.substr(e.lastIndexOf(".")+1,e.length)},getFontSize:function(){var e=arguments.length>0&&arguments[0]!==a?arguments[0]:{};if(!o.body||!1===e.resizeFont)return e.fontSize;var t=e.text,i=e.gifWidth,n=parseInt(e.fontSize,10),r=parseInt(e.minFontSize,10),s=o.createElement("div"),c=o.createElement("span");for(s.setAttribute("width",i),s.appendChild(c),c.innerHTML=t,c.style.fontSize=n+"px",c.style.textIndent="-9999px",c.style.visibility="hidden",o.body.appendChild(c);c.offsetWidth>i&&n>=r;)c.style.fontSize=--n+"px";return o.body.removeChild(c),n+"px"},webWorkerError:!1},l=Object.freeze({default:d}),u={validate:function(e){e=d.isObject(e)?e:{};var t={};return d.each(u.validators,(function(i,n){var o=n.errorCode;if(!e[o]&&!n.condition)return(t=n).error=!0,!1})),delete t.condition,t},isValid:function(e){return!0!==u.validate(e).error},validators:[{condition:d.isFunction(d.getUserMedia),errorCode:"getUserMedia",errorMsg:"The getUserMedia API is not supported in your browser"},{condition:d.isSupported.canvas(),errorCode:"canvas",errorMsg:"Canvas elements are not supported in your browser"},{condition:d.isSupported.webworkers(),errorCode:"webworkers",errorMsg:"The Web Workers API is not supported in your browser"},{condition:d.isFunction(d.URL),errorCode:"window.URL",errorMsg:"The window.URL API is not supported in your browser"},{condition:d.isSupported.blob(),errorCode:"window.Blob",errorMsg:"The window.Blob File API is not supported in your browser"},{condition:d.isSupported.Uint8Array(),errorCode:"window.Uint8Array",errorMsg:"The window.Uint8Array function constructor is not supported in your browser"},{condition:d.isSupported.Uint32Array(),errorCode:"window.Uint32Array",errorMsg:"The window.Uint32Array function constructor is not supported in your browser"}],messages:{videoCodecs:{errorCode:"videocodec",errorMsg:"The video codec you are trying to use is not supported in your browser"}}},h=Object.freeze({default:u}),f=function(){},m={sampleInterval:10,numWorkers:2,filter:"",gifWidth:200,gifHeight:200,interval:.1,numFrames:10,frameDuration:1,keepCameraOn:!1,images:[],video:null,webcamVideoElement:null,cameraStream:null,text:"",fontWeight:"normal",fontSize:"16px",minFontSize:"10px",resizeFont:!1,fontFamily:"sans-serif",fontColor:"#ffffff",textAlign:"center",textBaseline:"bottom",textXCoordinate:null,textYCoordinate:null,progressCallback:f,completeCallback:f,saveRenderingContexts:!1,savedRenderingContexts:[],showFrameText:!0,crossOrigin:"Anonymous",waterMark:null,waterMarkHeight:null,waterMarkWidth:null,waterMarkXCoordinate:1,waterMarkYCoordinate:1},g=Object.freeze({default:m});function v(){return u.isValid()}function p(){var e,t,i,n,o,r=256,a=499,s=491,c=487,d=503,l=3*d,u=r-1,h=4,f=100,m=16,g=1<<m,v=10,p=10,b=g>>p,w=g<<v-p,y=r>>3,x=6,E=1<<x,C=y*E,S=30,M=10,k=1<<M,O=8,T=1<<O,P=M+O,_=1<<P,V=[],A=[],F=[],j=[];function H(e,a,s){var c,d;for(t=e,i=a,n=s,o=new Array(r),c=0;c<r;c++)o[c]=new Array(4),(d=o[c])[0]=d[1]=d[2]=(c<<h+8)/r|0,F[c]=g/r|0,A[c]=0}function R(){for(var e=[],t=new Array(r),i=0;i<r;i++)t[o[i][3]]=i;for(var n=0,a=0;a<r;a++){var s=t[a];e[n++]=o[s][0],e[n++]=o[s][1],e[n++]=o[s][2]}return e}function U(){var e,t,i,n,a,s,c,d;for(c=0,d=0,e=0;e<r;e++){for(i=e,n=(a=o[e])[1],t=e+1;t<r;t++)(s=o[t])[1]<n&&(i=t,n=s[1]);if(s=o[i],e!=i&&(t=s[0],s[0]=a[0],a[0]=t,t=s[1],s[1]=a[1],a[1]=t,t=s[2],s[2]=a[2],a[2]=t,t=s[3],s[3]=a[3],a[3]=t),n!=c){for(V[c]=d+e>>1,t=c+1;t<n;t++)V[t]=e;c=n,d=e}}for(V[c]=d+u>>1,t=c+1;t<256;t++)V[t]=u}function L(){var o,r,u,m,g,v,p,b,w,y,E,M,O,P;for(i<l&&(n=1),e=30+(n-1)/3,M=t,O=0,P=i,y=(E=i/(3*n))/f|0,b=k,(p=(v=C)>>x)<=1&&(p=0),o=0;o<p;o++)j[o]=b*((p*p-o*o)*T/(p*p));for(w=i<l?3:i%a!=0?3*a:i%s!=0?3*s:i%c!=0?3*c:3*d,o=0;o<E;)if(B(b,r=G(u=(255&M[O+0])<<h,m=(255&M[O+1])<<h,g=(255&M[O+2])<<h),u,m,g),0!==p&&z(p,r,u,m,g),(O+=w)>=P&&(O-=i),0===y&&(y=1),++o%y==0)for(b-=b/e,(p=(v-=v/S)>>x)<=1&&(p=0),r=0;r<p;r++)j[r]=b*((p*p-r*r)*T/(p*p))}function W(e,t,i){var n,a,s,c,d,l,u;for(d=1e3,u=-1,a=(n=V[t])-1;n<r||a>=0;)n<r&&((s=(l=o[n])[1]-t)>=d?n=r:(n++,s<0&&(s=-s),(c=l[0]-e)<0&&(c=-c),(s+=c)<d&&((c=l[2]-i)<0&&(c=-c),(s+=c)<d&&(d=s,u=l[3])))),a>=0&&((s=t-(l=o[a])[1])>=d?a=-1:(a--,s<0&&(s=-s),(c=l[0]-e)<0&&(c=-c),(s+=c)<d&&((c=l[2]-i)<0&&(c=-c),(s+=c)<d&&(d=s,u=l[3]))));return u}function I(){return L(),D(),U(),R()}function D(){var e;for(e=0;e<r;e++)o[e][0]>>=h,o[e][1]>>=h,o[e][2]>>=h,o[e][3]=e}function z(e,t,i,n,a){var s,c,d,l,u,h,f;for((d=t-e)<-1&&(d=-1),(l=t+e)>r&&(l=r),s=t+1,c=t-1,h=1;s<l||c>d;){if(u=j[h++],s<l){f=o[s++];try{f[0]-=u*(f[0]-i)/_|0,f[1]-=u*(f[1]-n)/_|0,f[2]-=u*(f[2]-a)/_|0}catch(e){}}if(c>d){f=o[c--];try{f[0]-=u*(f[0]-i)/_|0,f[1]-=u*(f[1]-n)/_|0,f[2]-=u*(f[2]-a)/_|0}catch(e){}}}}function B(e,t,i,n,r){var a=o[t],s=e/k;a[0]-=s*(a[0]-i)|0,a[1]-=s*(a[1]-n)|0,a[2]-=s*(a[2]-r)|0}function G(e,t,i){var n,a,s,c,d,l,u,f,g,y;for(g=f=~(1<<31),u=l=-1,n=0;n<r;n++)(a=(y=o[n])[0]-e)<0&&(a=-a),(s=y[1]-t)<0&&(s=-s),a+=s,(s=y[2]-i)<0&&(s=-s),(a+=s)<f&&(f=a,l=n),(c=a-(A[n]>>m-h))<g&&(g=c,u=n),d=F[n]>>p,F[n]-=d,A[n]+=d<<v;return F[l]+=b,A[l]-=w,u}H.apply(this,arguments);var N={};return N.map=W,N.process=I,N}function b(){try{this.onmessage=function(t){var i,n=t.data||{};n.gifshot&&(i=e.run(n),postMessage(i))}}catch(e){}var e={dataToRGB:function(e,t,i){for(var n=t*i*4,o=0,r=[];o<n;)r.push(e[o++]),r.push(e[o++]),r.push(e[o++]),o++;return r},componentizedPaletteToArray:function(e){e=e||[];for(var t=[],i=0;i<e.length;i+=3){var n=e[i],o=e[i+1],r=e[i+2];t.push(n<<16|o<<8|r)}return t},processFrameWithQuantizer:function(e,t,i,n){for(var o=this.dataToRGB(e,t,i),r=new p(o,o.length,n),a=r.process(),s=new Uint32Array(this.componentizedPaletteToArray(a)),c=t*i,d=new Uint8Array(c),l=0,u=0;u<c;u++){var h=o[l++],f=o[l++],m=o[l++];d[u]=r.map(h,f,m)}return{pixels:d,palette:s}},run:function(e){var t=e=e||{},i=t.height,n=(t.palette,t.sampleInterval),o=t.width,r=e.data;return this.processFrameWithQuantizer(r,o,i,n)}};return e}function w(e,t,i,n){var o=0,r=(n=n===a?{}:n).loop===a?null:n.loop,s=n.palette===a?null:n.palette;if(t<=0||i<=0||t>65535||i>65535)throw"Width/Height invalid.";if(e[o++]=71,e[o++]=73,e[o++]=70,e[o++]=56,e[o++]=57,e[o++]=97,e[o++]=255&t,e[o++]=t>>8&255,e[o++]=255&i,e[o++]=i>>8&255,e[o++]=0|(null!==s?128:0),e[o++]=0,e[o++]=0,null!==r){if(r<0||r>65535)throw"Loop count invalid.";e[o++]=33,e[o++]=255,e[o++]=11,e[o++]=78,e[o++]=69,e[o++]=84,e[o++]=83,e[o++]=67,e[o++]=65,e[o++]=80,e[o++]=69,e[o++]=50,e[o++]=46,e[o++]=48,e[o++]=3,e[o++]=1,e[o++]=255&r,e[o++]=r>>8&255,e[o++]=0}var c=!1;this.addFrame=function(t,i,n,r,d,l){if(!0===c&&(--o,c=!1),l=l===a?{}:l,t<0||i<0||t>65535||i>65535)throw"x/y invalid.";if(n<=0||r<=0||n>65535||r>65535)throw"Width/Height invalid.";if(d.length<n*r)throw"Not enough pixels for the frame size.";var u=!0,h=l.palette;if(h!==a&&null!==h||(u=!1,h=s),h===a||null===h)throw"Must supply either a local or global palette.";for(var f=function(e){var t=e.length;if(t<2||t>256||t&t-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return t}(h),m=0;f>>=1;)++m;f=1<<m;var g=l.delay===a?0:l.delay,v=l.disposal===a?0:l.disposal;if(v<0||v>3)throw"Disposal out of range.";var p=!1,b=0;if(l.transparent!==a&&null!==l.transparent&&(p=!0,(b=l.transparent)<0||b>=f))throw"Transparent color index.";if((0!==v||p||0!==g)&&(e[o++]=33,e[o++]=249,e[o++]=4,e[o++]=v<<2|(!0===p?1:0),e[o++]=255&g,e[o++]=g>>8&255,e[o++]=b,e[o++]=0),e[o++]=44,e[o++]=255&t,e[o++]=t>>8&255,e[o++]=255&i,e[o++]=i>>8&255,e[o++]=255&n,e[o++]=n>>8&255,e[o++]=255&r,e[o++]=r>>8&255,e[o++]=!0===u?128|m-1:0,!0===u)for(var w=0,y=h.length;w<y;++w){var x=h[w];e[o++]=x>>16&255,e[o++]=x>>8&255,e[o++]=255&x}o=function(e,t,i,n){e[t++]=i;var o=t++,r=1<<i,s=r-1,c=r+1,d=c+1,l=i+1,u=0,h=0;function f(i){for(;u>=i;)e[t++]=255&h,h>>=8,u-=8,t===o+256&&(e[o]=255,o=t++)}function m(e){h|=e<<u,u+=l,f(8)}var g=n[0]&s,v={};m(r);for(var p=1,b=n.length;p<b;++p){var w=n[p]&s,y=g<<8|w,x=v[y];if(x===a){for(h|=g<<u,u+=l;u>=8;)e[t++]=255&h,h>>=8,u-=8,t===o+256&&(e[o]=255,o=t++);4096===d?(m(r),d=c+1,l=i+1,v={}):(d>=1<<l&&++l,v[y]=d++),g=w}else g=x}return m(g),m(c),f(1),o+1===t?e[o]=0:(e[o]=t-o-1,e[t++]=0),t}(e,o,m<2?2:m,d)},this.end=function(){return!1===c&&(e[o++]=59,c=!0),o}}var y=function(){},x=function(e){this.canvas=null,this.ctx=null,this.repeat=0,this.frames=[],this.numRenderedFrames=0,this.onRenderCompleteCallback=y,this.onRenderProgressCallback=y,this.workers=[],this.availableWorkers=[],this.generatingGIF=!1,this.options=e,this.initializeWebWorkers(e)};function E(e,t){e.getBase64GIF((function(e){t({error:!1,errorCode:"",errorMsg:"",image:e})}))}x.prototype={workerMethods:b(),initializeWebWorkers:function(e){var t,i=p.toString()+"("+b.toString()+"());",n=void 0,r=void 0,a=void 0,s=-1,c="";for(t=e.numWorkers;++s<t;)n=d.createWebWorker(i),d.isObject(n)?(r=n.objectUrl,a=n.worker,this.workers.push({worker:a,objectUrl:r}),this.availableWorkers.push(a)):(c=n,d.webWorkerError=!!n);this.workerError=c,this.canvas=o.createElement("canvas"),this.canvas.width=e.gifWidth,this.canvas.height=e.gifHeight,this.ctx=this.canvas.getContext("2d"),this.frames=[]},getWorker:function(){return this.availableWorkers.pop()},freeWorker:function(e){this.availableWorkers.push(e)},byteMap:function(){for(var e=[],t=0;t<256;t++)e[t]=String.fromCharCode(t);return e}(),bufferToString:function(e){for(var t=e.length,i="",n=-1;++n<t;)i+=this.byteMap[e[n]];return i},onFrameFinished:function(e){var t=this,i=t.frames,n=!!(t.options.images||[]).length,o=i.every((function(e){return!e.beingProcessed&&e.done}));t.numRenderedFrames++,n&&e(t.numRenderedFrames/i.length),t.onRenderProgressCallback(.75*t.numRenderedFrames/i.length),o?t.generatingGIF||t.generateGIF(i,t.onRenderCompleteCallback):d.requestTimeout((function(){t.processNextFrame()}),1)},processFrame:function(e){var t=this,i=(this.options,this.options),n=i.progressCallback,o=i.sampleInterval,r=this.frames,s=void 0,c=void 0,d=function(){var e=arguments.length>0&&arguments[0]!==a?arguments[0]:{},i=e.data;delete s.data,s.pixels=Array.prototype.slice.call(i.pixels),s.palette=Array.prototype.slice.call(i.palette),s.done=!0,s.beingProcessed=!1,t.freeWorker(c),t.onFrameFinished(n)};(s=r[e]).beingProcessed||s.done?this.onFrameFinished():(s.sampleInterval=o,s.beingProcessed=!0,s.gifshot=!0,(c=this.getWorker())?(c.onmessage=d,c.postMessage(s)):d({data:t.workerMethods.run(s)}))},startRendering:function(e){this.onRenderCompleteCallback=e;for(var t=0;t<this.options.numWorkers&&t<this.frames.length;t++)this.processFrame(t)},processNextFrame:function(){for(var e=-1,t=0;t<this.frames.length;t++){var i=this.frames[t];if(!i.done&&!i.beingProcessed){e=t;break}}e>=0&&this.processFrame(e)},generateGIF:function(e,t){var i=[],n={loop:this.repeat},o=this.options,r=o.interval,a=o.frameDuration,s=!!o.images.length,c=o.gifHeight,l=o.gifWidth,u=new w(i,l,c,n),h=this.onRenderProgressCallback,f=s?100*r:0,m=void 0;this.generatingGIF=!0,d.each(e,(function(t,i){var n=i.palette;h(.75+.25*i.position*1/e.length);for(var o=0;o<a;o++)u.addFrame(0,0,l,c,i.pixels,{palette:n,delay:f})})),u.end(),h(1),this.frames=[],this.generatingGIF=!1,d.isFunction(t)&&(m=this.bufferToString(i),t("data:image/gif;base64,"+d.btoa(m)))},setRepeat:function(e){this.repeat=e},addFrame:function(e,t,i){t=d.isObject(t)?t:{};var n=this,o=n.ctx,r=n.options,a=r.gifWidth,s=r.gifHeight,c=d.getFontSize(t),l=t,u=l.filter,h=l.fontColor,f=l.fontFamily,m=l.fontWeight,g=(l.gifHeight,l.gifWidth,l.text),v=l.textAlign,p=l.textBaseline,b=l.waterMark,w=l.waterMarkHeight,y=l.waterMarkWidth,x=l.waterMarkXCoordinate,E=l.waterMarkYCoordinate,C=t.textXCoordinate?t.textXCoordinate:"left"===v?1:"right"===v?a:a/2,S=t.textYCoordinate?t.textYCoordinate:"top"===p?1:"center"===p?s/2:s,M=m+" "+c+" "+f,k=i&&t.showFrameText?i:g,O=void 0;try{o.filter=u,o.drawImage(e,0,0,a,s),k&&(o.font=M,o.fillStyle=h,o.textAlign=v,o.textBaseline=p,o.fillText(k,C,S)),b&&o.drawImage(b,x,E,y,w),O=o.getImageData(0,0,a,s),n.addFrameImageData(O)}catch(e){return""+e}},addFrameImageData:function(){var e=arguments.length>0&&arguments[0]!==a?arguments[0]:{},t=this.frames,i=e.data;this.frames.push({data:i,width:e.width,height:e.height,palette:null,dithering:null,done:!1,beingProcessed:!1,position:t.length})},onRenderProgress:function(e){this.onRenderProgressCallback=e},isRendering:function(){return this.generatingGIF},getBase64GIF:function(e){var t=this;t.startRendering((function(i){t.destroyWorkers(),d.requestTimeout((function(){e(i)}),0)}))},destroyWorkers:function(){if(!this.workerError){var e=this.workers;d.each(e,(function(e,t){var i=t.worker,n=t.objectUrl;i.terminate(),d.URL.revokeObjectURL(n)}))}}};var C=function(){},S=function(){var e=arguments.length>0&&arguments[0]!==a?arguments[0]:{},t=arguments[1];t=d.isFunction(t)?t:C;var i=o.createElement("canvas"),n=void 0,r=e.images,s=!!r.length,c=e.cameraStream,l=e.crop,u=e.filter,h=e.fontColor,f=e.fontFamily,m=e.fontWeight,g=e.keepCameraOn,v=(e.numWorkers,e.progressCallback),p=e.saveRenderingContexts,b=e.savedRenderingContexts,w=e.text,y=e.textAlign,E=e.textBaseline,S=e.videoElement,M=e.videoHeight,k=e.videoWidth,O=e.webcamVideoElement,T=e.waterMark,P=e.waterMarkHeight,_=e.waterMarkWidth,V=e.waterMarkXCoordinate,A=e.waterMarkYCoordinate,F=Number(e.gifWidth),j=Number(e.gifHeight),H=Number(e.interval),R=(Number(e.sampleInterval),s?0:1e3*H),U=[],L=b.length?b.length:e.numFrames,W=L,I=new x(e),D=d.getFontSize(e),z=e.textXCoordinate?e.textXCoordinate:"left"===y?1:"right"===y?F:F/2,B=e.textYCoordinate?e.textYCoordinate:"top"===E?1:"center"===E?j/2:j,G=m+" "+D+" "+f,N=l?Math.floor(l.scaledWidth/2):0,q=l?k-l.scaledWidth:0,X=l?Math.floor(l.scaledHeight/2):0,Y=l?M-l.scaledHeight:0,$=function e(){var i=W-1;function o(){var o;p&&U.push(n.getImageData(0,0,F,j)),T&&n.drawImage(T,V,A,_,P),w&&(n.font=G,n.fillStyle=h,n.textAlign=y,n.textBaseline=E,n.fillText(w,z,B)),o=n.getImageData(0,0,F,j),I.addFrameImageData(o),v((L-(W=i))/L),i>0&&d.requestTimeout(e,R),W||I.getBase64GIF((function(e){t({error:!1,errorCode:"",errorMsg:"",image:e,cameraStream:c,videoElement:S,webcamVideoElement:O,savedRenderingContexts:U,keepCameraOn:g})}))}b.length?(n.putImageData(b[L-W],0,0),o()):function e(){try{q>k&&(q=k),Y>M&&(Y=M),N<0&&(N=0),X<0&&(X=0),n.filter=u,n.drawImage(S,N,X,q,Y,0,0,F,j),o()}catch(t){if("NS_ERROR_NOT_AVAILABLE"!==t.name)throw t;d.requestTimeout(e,100)}}()};L=L!==a?L:10,H=H!==a?H:.1,i.width=F,i.height=j,n=i.getContext("2d"),function e(){b.length||0!==S.currentTime?$():d.requestTimeout(e,100)}()},M={loadedData:!1,defaultVideoDimensions:{width:640,height:480},findVideoSize:function e(t){e.attempts=e.attempts||0;var i=t.cameraStream,n=t.completedCallback,o=t.videoElement;o&&(o.videoWidth>0&&o.videoHeight>0?(o.removeEventListener("loadeddata",M.findVideoSize),n({videoElement:o,cameraStream:i,videoWidth:o.videoWidth,videoHeight:o.videoHeight})):e.attempts<10?(e.attempts+=1,d.requestTimeout((function(){M.findVideoSize(t)}),400)):n({videoElement:o,cameraStream:i,videoWidth:M.defaultVideoDimensions.width,videoHeight:M.defaultVideoDimensions.height}))},onStreamingTimeout:function(e){d.isFunction(e)&&e({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - Timed out while trying to start streaming",image:null,cameraStream:{}})},stream:function(e){var t=d.isArray(e.existingVideo)?e.existingVideo[0]:e.existingVideo,i=e.cameraStream,n=e.completedCallback,o=e.streamedCallback,r=e.videoElement;if(d.isFunction(o)&&o(),t){if(d.isString(t))r.src=t,r.innerHTML='<source src="'+t+'" type="video/'+d.getExtension(t)+'" />';else if(t instanceof Blob){try{r.src=d.URL.createObjectURL(t)}catch(e){}r.innerHTML='<source src="'+t+'" type="'+t.type+'" />'}}else if(r.mozSrcObject)r.mozSrcObject=i;else if(d.URL)try{r.srcObject=i,r.src=d.URL.createObjectURL(i)}catch(e){r.srcObject=i}r.play(),d.requestTimeout((function e(){e.count=e.count||0,!0===M.loadedData?(M.findVideoSize({videoElement:r,cameraStream:i,completedCallback:n}),M.loadedData=!1):(e.count+=1)>10?M.findVideoSize({videoElement:r,cameraStream:i,completedCallback:n}):e()}),0)},startStreaming:function(e){var t=d.isFunction(e.error)?e.error:d.noop,i=d.isFunction(e.streamed)?e.streamed:d.noop,n=d.isFunction(e.completed)?e.completed:d.noop,r=e.crossOrigin,a=e.existingVideo,s=e.lastCameraStream,c=e.options,l=e.webcamVideoElement,u=d.isElement(a)?a:l||o.createElement("video");r&&(u.crossOrigin=c.crossOrigin),u.autoplay=!0,u.loop=!0,u.muted=!0,u.addEventListener("loadeddata",(function(e){M.loadedData=!0,c.offset&&(u.currentTime=c.offset)})),a?M.stream({videoElement:u,existingVideo:a,completedCallback:n}):s?M.stream({videoElement:u,cameraStream:s,streamedCallback:i,completedCallback:n}):d.getUserMedia({video:!0},(function(e){M.stream({videoElement:u,cameraStream:e,streamedCallback:i,completedCallback:n})}),t)},startVideoStreaming:function(e){var t=arguments.length>1&&arguments[1]!==a?arguments[1]:{},i=t.timeout!==a?t.timeout:0,n=t.callback,o=t.webcamVideoElement,r=void 0;i>0&&(r=d.requestTimeout((function(){M.onStreamingTimeout(n)}),1e4)),M.startStreaming({error:function(){n({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - the user probably denied permission",image:null,cameraStream:{}})},streamed:function(){clearTimeout(r)},completed:function(){var t=arguments.length>0&&arguments[0]!==a?arguments[0]:{},i=t.cameraStream,n=t.videoElement,o=t.videoHeight,r=t.videoWidth;e({cameraStream:i,videoElement:n,videoHeight:o,videoWidth:r})},lastCameraStream:t.lastCameraStream,webcamVideoElement:o,crossOrigin:t.crossOrigin,options:t})},stopVideoStreaming:function(e){var t=e=d.isObject(e)?e:{},i=t.keepCameraOn,n=t.videoElement,o=t.webcamVideoElement,r=e.cameraStream||{},a=r.getTracks&&r.getTracks()||[],s=!!a.length,c=a[0];!i&&s&&d.isFunction(c.stop)&&c.stop(),d.isElement(n)&&!o&&(n.pause(),d.isFunction(d.URL.revokeObjectURL)&&!d.webWorkerError&&n.src&&d.URL.revokeObjectURL(n.src),d.removeElement(n))}};function k(e){e=d.isObject(e)?e:{},M.stopVideoStreaming(e)}function O(e,t){var i=e.options||{},n=i.images,r=i.video,s=Number(i.gifWidth),c=Number(i.gifHeight),l=(Number(i.numFrames),e.cameraStream),u=e.videoElement,h=e.videoWidth,f=e.videoHeight,m=function(){var e=arguments.length>0&&arguments[0]!==a?arguments[0]:{},t=e.videoWidth,i=e.videoHeight,n=e.gifWidth,o=e.gifHeight,r={width:0,height:0,scaledWidth:0,scaledHeight:0};return t>i?(r.width=Math.round(t*(o/i))-n,r.scaledWidth=Math.round(r.width*(i/o))):(r.height=Math.round(i*(n/t))-o,r.scaledHeight=Math.round(r.height*(t/n))),r}({videoWidth:h,videoHeight:f,gifHeight:c,gifWidth:s}),g=t;i.crop=m,i.videoElement=u,i.videoWidth=h,i.videoHeight=f,i.cameraStream=l,d.isElement(u)&&(u.width=s+m.width,u.height=c+m.height,i.webcamVideoElement||(d.setCSSAttr(u,{position:"fixed",opacity:"0"}),o.body.appendChild(u)),u.play(),S(i,(function(e){n&&n.length||r&&r.length||k(e),g(e)})))}function T(e,t){if(t=d.isFunction(e)?e:t,e=d.isObject(e)?e:{},d.isFunction(t)){var i=d.mergeOptions(m,e)||{},n=e.cameraStream,r=i.images,s=r?r.length:0,c=i.video,l=i.webcamVideoElement;i=d.mergeOptions(i,{gifWidth:Math.floor(i.gifWidth),gifHeight:Math.floor(i.gifHeight)}),s?function(){var e=arguments.length>0&&arguments[0]!==a?arguments[0]:{},t=e.callback,i=e.images,n=e.options,r=e.imagesLength,s={getUserMedia:!0,"window.URL":!0},c=u.validate(s),l=[],h=0,f=void 0,m=void 0;if(c.error)return t(c);function g(){d.each(l,(function(e,t){t&&(t.text?m.addFrame(t.img,n,t.text):m.addFrame(t,n))})),E(m,t)}m=new x(n),d.each(i,(function(e,i){var a=i;i.src&&(a=a.src),d.isElement(a)?(n.crossOrigin&&(a.crossOrigin=n.crossOrigin),l[e]=a,(h+=1)===r&&g()):d.isString(a)&&(f=new Image,n.crossOrigin&&(f.crossOrigin=n.crossOrigin),function(n){i.text&&(n.text=i.text),n.onerror=function(e){var i=void 0;if(0==--r)return(i={}).error="None of the requested images was capable of being retrieved",t(i)},n.onload=function(t){i.text?l[e]={img:n,text:n.text}:l[e]=n,(h+=1)===r&&g(),d.removeElement(n)},n.src=a}(f),d.setCSSAttr(f,{position:"fixed",opacity:"0"}),o.body.appendChild(f))}))}({images:r,imagesLength:s,callback:t,options:i}):c?function(){var e=arguments.length>0&&arguments[0]!==a?arguments[0]:{},t=e.callback,i=e.existingVideo,n=e.options,o={getUserMedia:!0,"window.URL":!0},r=u.validate(o),s=void 0,c=void 0;if(r.error)return t(r);if(d.isElement(i)&&i.src){if(c=i.src,s=d.getExtension(c),!d.isSupported.videoCodecs[s])return t(u.messages.videoCodecs)}else d.isArray(i)&&d.each(i,(function(e,t){if(s=t instanceof Blob?t.type.substr(t.type.lastIndexOf("/")+1,t.length):t.substr(t.lastIndexOf(".")+1,t.length),d.isSupported.videoCodecs[s])return i=t,!1}));M.startStreaming({completed:function(e){e.options=n||{},O(e,t)},existingVideo:i,crossOrigin:n.crossOrigin,options:n})}({existingVideo:c,callback:t,options:i}):function(){var e=arguments.length>0&&arguments[0]!==a?arguments[0]:{},t=e.callback,i=e.lastCameraStream,n=e.options,o=e.webcamVideoElement;if(!v())return t(u.validate());n.savedRenderingContexts.length?S(n,(function(e){t(e)})):M.startVideoStreaming((function(){var e=arguments.length>0&&arguments[0]!==a?arguments[0]:{};e.options=n||{},O(e,t)}),{lastCameraStream:i,callback:t,webcamVideoElement:o,crossOrigin:n.crossOrigin})}({lastCameraStream:n,callback:t,webcamVideoElement:l,options:i})}}var P={utils:l,error:h,defaultOptions:g,createGIF:T,takeSnapShot:function(e,t){if(t=d.isFunction(e)?e:t,e=d.isObject(e)?e:{},d.isFunction(t)){var i=d.mergeOptions(m,e);T(d.mergeOptions(i,{interval:.1,numFrames:1,gifWidth:Math.floor(i.gifWidth),gifHeight:Math.floor(i.gifHeight)}),t)}},stopVideoStreaming:k,isSupported:function(){return u.isValid()},isWebCamGIFSupported:v,isExistingVideoGIFSupported:function(e){var t=!1;if(d.isArray(e)&&e.length){if(d.each(e,(function(e,i){d.isSupported.videoCodecs[i]&&(t=!0)})),!t)return!1}else if(d.isString(e)&&e.length&&!d.isSupported.videoCodecs[e])return!1;return u.isValid({getUserMedia:!0})},isExistingImagesGIFSupported:function(){return u.isValid({getUserMedia:!0})},VERSION:"0.4.5"};(i=function(){return P}.apply(t,[]))===a||(e.exports=i)}("undefined"!=typeof window?window:{},"undefined"!=typeof document?document:{createElement:function(){}},"undefined"!=typeof window?window.navigator:{})},428:function(e){"use strict";e.exports=THREE}},t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,i),o.exports}i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i(341)}();
//# sourceMappingURL=main.ec85154c74267faf9b14.js.map